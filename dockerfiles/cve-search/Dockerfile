FROM ubuntu:16.04

WORKDIR /opt
RUN apt-get -y update
RUN apt-get -y install python redis-server mongodb python3 python3-pip tar
ADD https://github.com/cve-search/cve-search/archive/v2.2.tar.gz /opt/v2.2.tar.gz
WORKDIR /opt
RUN tar -xzf v2.2.tar.gz
WORKDIR /opt/cve-search-2.2
RUN pip3 install -r requirements.txt
RUN mkdir -p /data/db
RUN mongod --fork --smallfiles --config /etc/mongodb.conf; python3 sbin/db_mgmt.py -p
RUN mongod --fork --smallfiles --config /etc/mongodb.conf; python3 sbin/db_mgmt_cpe_dictionary.py
RUN mongod --fork --smallfiles --config /etc/mongodb.conf; python3 sbin/db_updater.py -c
RUN mongod --fork --smallfiles --config /etc/mongodb.conf; python3 sbin/db_mgmt_ref.py
ADD entry.sh /opt/entry.sh

CMD ["/bin/bash", "/opt/entry.sh"]
